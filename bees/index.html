<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bee Test</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
</head>

<body style="text-align: center">

<canvas id="garden" width="1500" height="900"
        style="background-image: url(garden.jpg); border: 1px solid black; cursor: none; margin: auto;"></canvas>

<img id="flower" src="flower.png" width="100" height="99" style="display: none;"/>

<img id="bee-left" src="bee-small-left.png" width="50" height="41" style="display: none;"/>
<img id="bee-right" src="bee-small-right.png" width="50" height="41" style="display: none;"/>

<script>

    $("#garden").mousemove(function (event) {
        flowerOn = true;
        mouse.x = event.clientX;
        mouse.y = event.clientY;
        buzzBees();
    }).mouseout(function (event) {
        flowerOn = false;
        restBees();
    });

    $(function () {
        bees[0] = new Bee(215, 795, -80, -70, 100, 15);
        bees[1] = new Bee(430, 810, -10, -60, 200, 20);
        bees[2] = new Bee(700, 830, 80, 0, 100, 30);
        bees[3] = new Bee(1040, 780, 20, 90, 40, 80);
        bees[4] = new Bee(1240, 820, -95, 70, 50, 50);
        setInterval(function () {
            updateBees();
            refresh();
        }, 10);
    });

    var threshold = 10;
    var jitter = true;
    var bees = [];
    var mouse = {};
    var flowerOn = false;

    function refresh() {
        var c = document.getElementById("garden");
        var ctx = c.getContext("2d");
        ctx.clearRect(0, 0, 1500, 900);

        if (flowerOn) {
            ctx.drawImage(document.getElementById("flower"), mouse.x - 120, mouse.y - 50);
        }

        for (var i = 0; i < bees.length; i++) {
            var img = bees[i].targetX > bees[i].x ? "bee-right" : "bee-left";
            ctx.drawImage(document.getElementById(img), bees[i].x - 25, bees[i].y - 20);
        }
    }

    function updateBees() {
        for (var i = 0; i < bees.length; i++) {
            bees[i].updatePosition();
        }
    }

    function buzzBees() {
        for (var i = 0; i < bees.length; i++) {
            bees[i].buzzTo(mouse.x - 40, mouse.y);
        }
    }

    function restBees() {
        for (var i = 0; i < bees.length; i++) {
            bees[i].rest();
        }
    }

    function Bee(x, y, offX, offY, linearSpeed, angularSpeed) {
        this.x = this.currentX = this.restX = this.targetX = x;
        this.y = this.currentY = this.restY = this.targetY = y;
        this.offsetX = offX;
        this.offsetY = offY;
        this.linearSpeed = linearSpeed;
        this.dX = this.dY = 0;
        this.radius = 0;
        this.theta = 0;
        this.dT = 1 / angularSpeed;
    }

    Bee.prototype.buzzTo = function (x, y) {
        this.targetX = x + this.offsetX;
        this.targetY = y + this.offsetY;
        this.updateDelta();
    };

    Bee.prototype.rest = function () {
        this.targetX = this.restX;
        this.targetY = this.restY;
        this.updateDelta();
    };

    Bee.prototype.updateDelta = function () {
        this.dX = (this.targetX - this.currentX) / this.linearSpeed;
        this.dY = (this.targetY - this.currentY) / this.linearSpeed;
    };

    Bee.prototype.updatePosition = function () {
        if (Math.abs(this.targetX - this.currentX) > threshold) {
            this.currentX += this.dX;
        }
        if (Math.abs(this.targetY - this.currentY) > threshold) {
            this.currentY += this.dY;
        }
        this.x = this.currentX + ( jitter ? Math.sin(this.theta) * this.radius : 0 );
        this.y = this.currentY + ( jitter ? Math.cos(this.theta) * this.radius : 0 );
        if ( jitter ) {
            this.radius = (Math.abs(this.currentX - this.restX) + Math.abs(this.currentY - this.restY)) / 40;
            if (this.radius > 3) {
                this.theta += this.dT;
                if (this.theta > 2 * Math.PI) {
                    this.theta = 0;
                }
            }
        }
    };

</script>


</body>
</html>